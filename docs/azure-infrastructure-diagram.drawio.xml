<mxfile host="app.diagrams.net" modified="2024-01-23T00:00:00.000Z" agent="Claude Code" etag="azure-infra" version="22.1.11" type="device">
  <diagram name="Azure Infrastructure" id="azure-infrastructure-diagram">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Azure Subscription -->
        <mxCell id="azure-subscription" value="Azure Subscription" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="1520" height="1200" as="geometry" />
        </mxCell>

        <!-- Terraform State Resource Group -->
        <mxCell id="tf-state-rg" value="Resource Group: rg-terraform-state" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="azure-subscription">
          <mxGeometry x="40" y="40" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="tf-storage" value="Storage Account&#xa;sttfstateXXXXXX&#xa;&#xa;• Standard_LRS&#xa;• Server-side encryption&#xa;• Blob lease locking" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="tf-state-rg">
          <mxGeometry x="20" y="40" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="tf-container" value="Container: tfstate&#xa;&#xa;• larios-income-tax-dev.tfstate&#xa;• larios-income-tax-prod.tfstate" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="tf-state-rg">
          <mxGeometry x="40" y="80" width="320" height="80" as="geometry" />
        </mxCell>

        <!-- Development Environment -->
        <mxCell id="dev-env-rg" value="Resource Group: rg-larios-income-tax-dev" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="azure-subscription">
          <mxGeometry x="40" y="280" width="680" height="840" as="geometry" />
        </mxCell>

        <!-- Dev App Service Plan -->
        <mxCell id="dev-plan" value="App Service Plan&#xa;asp-larios-income-tax-dev" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;" vertex="1" parent="dev-env-rg">
          <mxGeometry x="40" y="40" width="600" height="180" as="geometry" />
        </mxCell>
        <mxCell id="dev-plan-details" value="SKU: B1 (Basic)&#xa;OS: Linux&#xa;Cost: ~$13/month&#xa;Always On: Disabled&#xa;&#xa;Purpose: Cost-effective development hosting" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="dev-plan">
          <mxGeometry x="20" y="40" width="560" height="120" as="geometry" />
        </mxCell>

        <!-- Dev App Service -->
        <mxCell id="dev-app" value="App Service&#xa;app-larios-income-tax-dev" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;" vertex="1" parent="dev-env-rg">
          <mxGeometry x="40" y="240" width="600" height="280" as="geometry" />
        </mxCell>
        <mxCell id="dev-app-details" value="Runtime: Docker Container&#xa;Image: lariosincometax-website:latest&#xa;HTTPS Only: Yes&#xa;Minimum TLS: 1.2&#xa;FTPS: Disabled&#xa;&#xa;URL:&#xa;https://app-larios-income-tax-dev.azurewebsites.net&#xa;&#xa;Configuration:&#xa;• DOCKER_REGISTRY_SERVER_URL&#xa;• DOCKER_REGISTRY_SERVER_USERNAME&#xa;• DOCKER_REGISTRY_SERVER_PASSWORD&#xa;• APPINSIGHTS_INSTRUMENTATIONKEY" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="dev-app">
          <mxGeometry x="20" y="40" width="560" height="220" as="geometry" />
        </mxCell>

        <!-- Dev Managed Identity -->
        <mxCell id="dev-identity" value="Managed Identity&#xa;(System-Assigned)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="dev-env-rg">
          <mxGeometry x="40" y="540" width="280" height="60" as="geometry" />
        </mxCell>

        <!-- Dev Application Insights -->
        <mxCell id="dev-insights" value="Application Insights&#xa;appi-larios-income-tax-dev" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;" vertex="1" parent="dev-env-rg">
          <mxGeometry x="360" y="540" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="dev-insights-details" value="Type: Web Application&#xa;Retention: 90 days&#xa;&#xa;Monitoring:&#xa;• Request rates&#xa;• Response times&#xa;• Failed requests&#xa;• Exceptions&#xa;• Dependencies&#xa;• Custom metrics" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="dev-insights">
          <mxGeometry x="10" y="40" width="260" height="125" as="geometry" />
        </mxCell>

        <!-- Dev Log Analytics -->
        <mxCell id="dev-logs" value="Log Analytics Workspace&#xa;&#xa;• Application logs (7 days)&#xa;• Web server logs (7 days)&#xa;• Detailed error messages&#xa;• Failed request tracing" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="dev-env-rg">
          <mxGeometry x="40" y="620" width="280" height="120" as="geometry" />
        </mxCell>

        <!-- Production Environment -->
        <mxCell id="prod-env-rg" value="Resource Group: rg-larios-income-tax-prod" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" vertex="1" parent="azure-subscription">
          <mxGeometry x="800" y="280" width="680" height="840" as="geometry" />
        </mxCell>

        <!-- Prod App Service Plan -->
        <mxCell id="prod-plan" value="App Service Plan&#xa;asp-larios-income-tax-prod" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;" vertex="1" parent="prod-env-rg">
          <mxGeometry x="40" y="40" width="600" height="180" as="geometry" />
        </mxCell>
        <mxCell id="prod-plan-details" value="SKU: P1v2 (Premium)&#xa;OS: Linux&#xa;Cost: ~$73/month&#xa;Always On: Enabled&#xa;&#xa;Purpose: Production-grade hosting with&#xa;enhanced performance and availability" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="prod-plan">
          <mxGeometry x="20" y="40" width="560" height="120" as="geometry" />
        </mxCell>

        <!-- Prod App Service -->
        <mxCell id="prod-app" value="App Service&#xa;app-larios-income-tax-prod" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;" vertex="1" parent="prod-env-rg">
          <mxGeometry x="40" y="240" width="600" height="280" as="geometry" />
        </mxCell>
        <mxCell id="prod-app-details" value="Runtime: Docker Container&#xa;Image: lariosincometax-website:v1.0.0&#xa;HTTPS Only: Yes&#xa;Minimum TLS: 1.2&#xa;FTPS: Disabled&#xa;&#xa;URL:&#xa;https://app-larios-income-tax-prod.azurewebsites.net&#xa;&#xa;Configuration:&#xa;• DOCKER_REGISTRY_SERVER_URL&#xa;• DOCKER_REGISTRY_SERVER_USERNAME&#xa;• DOCKER_REGISTRY_SERVER_PASSWORD&#xa;• APPINSIGHTS_INSTRUMENTATIONKEY" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="prod-app">
          <mxGeometry x="20" y="40" width="560" height="220" as="geometry" />
        </mxCell>

        <!-- Prod Managed Identity -->
        <mxCell id="prod-identity" value="Managed Identity&#xa;(System-Assigned)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="prod-env-rg">
          <mxGeometry x="40" y="540" width="280" height="60" as="geometry" />
        </mxCell>

        <!-- Prod Application Insights -->
        <mxCell id="prod-insights" value="Application Insights&#xa;appi-larios-income-tax-prod" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;" vertex="1" parent="prod-env-rg">
          <mxGeometry x="360" y="540" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="prod-insights-details" value="Type: Web Application&#xa;Retention: 90 days&#xa;&#xa;Monitoring:&#xa;• Request rates&#xa;• Response times&#xa;• Failed requests&#xa;• Exceptions&#xa;• Dependencies&#xa;• Custom metrics" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="prod-insights">
          <mxGeometry x="10" y="40" width="260" height="125" as="geometry" />
        </mxCell>

        <!-- Prod Log Analytics -->
        <mxCell id="prod-logs" value="Log Analytics Workspace&#xa;&#xa;• Application logs (7 days)&#xa;• Web server logs (7 days)&#xa;• Detailed error messages&#xa;• Failed request tracing" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="prod-env-rg">
          <mxGeometry x="40" y="620" width="280" height="120" as="geometry" />
        </mxCell>

        <!-- External Services -->
        <mxCell id="external-services" value="External Services" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="azure-subscription">
          <mxGeometry x="520" y="40" width="400" height="200" as="geometry" />
        </mxCell>

        <!-- Docker Hub -->
        <mxCell id="docker-hub" value="Docker Hub" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-services">
          <mxGeometry x="20" y="40" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="docker-hub-details" value="Repository:&#xa;USERNAME/lariosincometax-website&#xa;&#xa;Tags:&#xa;• latest (dev)&#xa;• v1.0.0, v1.0, v1 (prod)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="docker-hub">
          <mxGeometry x="10" y="40" width="340" height="85" as="geometry" />
        </mxCell>

        <!-- GitHub -->
        <mxCell id="github" value="GitHub" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="external-services">
          <mxGeometry x="980" y="40" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="github-details" value="Repository:&#xa;lario-income-tax-website&#xa;&#xa;Secrets:&#xa;• AZURE_CLIENT_ID&#xa;• AZURE_CLIENT_SECRET&#xa;• AZURE_SUBSCRIPTION_ID&#xa;• AZURE_TENANT_ID&#xa;• TF_BACKEND_*&#xa;• DOCKERHUB_*" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="github">
          <mxGeometry x="10" y="40" width="380" height="145" as="geometry" />
        </mxCell>

        <!-- Service Principal -->
        <mxCell id="service-principal" value="Azure AD Service Principal&#xa;&#xa;Name: larios-income-tax-terraform&#xa;Role: Contributor&#xa;Scope: Subscription&#xa;&#xa;Used by:&#xa;• GitHub Actions&#xa;• Terraform" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;" vertex="1" parent="azure-subscription">
          <mxGeometry x="1040" y="40" width="280" height="160" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <!-- GitHub to Service Principal -->
        <mxCell id="conn1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#6c8ebf;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="github" target="service-principal">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn1-label" value="Authenticates" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Service Principal to Dev RG -->
        <mxCell id="conn2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;strokeColor=#82b366;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="service-principal" target="dev-env-rg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn2-label" value="Manages" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn2">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Service Principal to Prod RG -->
        <mxCell id="conn3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d6b656;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="service-principal" target="prod-env-rg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn3-label" value="Manages" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn3">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Service Principal to TF State -->
        <mxCell id="conn4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#6c8ebf;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="service-principal" target="tf-state-rg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn4-label" value="Reads/Writes State" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn4">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Docker Hub to Dev App -->
        <mxCell id="conn5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#82b366;strokeWidth=2" edge="1" parent="azure-subscription" source="docker-hub" target="dev-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn5-label" value="Pulls :latest" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn5">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Docker Hub to Prod App -->
        <mxCell id="conn6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d6b656;strokeWidth=2" edge="1" parent="azure-subscription" source="docker-hub" target="prod-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn6-label" value="Pulls :v1.0.0" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn6">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Dev App to Dev Insights -->
        <mxCell id="conn7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#82b366;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="dev-app" target="dev-insights">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn7-label" value="Sends Telemetry" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn7">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Prod App to Prod Insights -->
        <mxCell id="conn8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d6b656;strokeWidth=2;dashed=1" edge="1" parent="azure-subscription" source="prod-app" target="prod-insights">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn8-label" value="Sends Telemetry" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontStyle=1" vertex="1" connectable="0" parent="conn8">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Title -->
        <mxCell id="title" value="Larios Income Tax Website - Azure Infrastructure Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="1280" width="1520" height="40" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="Legend" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="1340" width="500" height="140" as="geometry" />
        </mxCell>
        <mxCell id="legend-dev" value="Development Environment (B1 SKU, ~$13/month)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="legend">
          <mxGeometry x="20" y="40" width="460" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-prod" value="Production Environment (P1v2 SKU, ~$73/month)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="legend">
          <mxGeometry x="20" y="80" width="460" height="30" as="geometry" />
        </mxCell>

        <!-- Notes -->
        <mxCell id="notes" value="Notes" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="600" y="1340" width="960" height="140" as="geometry" />
        </mxCell>
        <mxCell id="notes-text" value="• Terraform manages all infrastructure as code&#xa;• Service Principal used for GitHub Actions authentication&#xa;• Docker images pulled from Docker Hub public repository&#xa;• Application Insights provides monitoring and telemetry&#xa;• Managed Identities provide secure access to Azure services&#xa;• HTTPS enforced with minimum TLS 1.2" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="notes">
          <mxGeometry x="20" y="40" width="920" height="90" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
